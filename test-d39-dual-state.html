<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test d_39 Dual-State Separation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .status { padding: 10px; margin: 10px 0; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 8px 16px; }
        select { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
    <h1>Test d_39 (Building Typology) Dual-State Separation</h1>
    
    <div class="test-section">
        <h2>Test Instructions</h2>
        <ol>
            <li>Open the main TEUI application in another tab</li>
            <li>Navigate to Section 05 (CO2e Emissions)</li>
            <li>Note the current building typology and i_39 value in Design Mode</li>
            <li>Toggle to Reference Mode</li>
            <li>Change the building typology dropdown and <strong>watch i_39 update immediately</strong></li>
            <li>Toggle back to Design Mode</li>
            <li>Verify that the Design Mode typology and i_39 are different from Reference Mode</li>
            <li>Check Section 01 to see different values in Column E (Reference) vs Column H (Target)</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h2>Expected Behavior</h2>
        <div class="info status">
            <strong>✓ Design Mode:</strong> Should maintain its own building typology selection<br>
            <strong>✓ Reference Mode:</strong> Should allow independent building typology selection<br>
            <strong>✓ State Separation:</strong> Changes in one mode should not affect the other<br>
            <strong>✓ UI Updates:</strong> i_39 should update immediately and visibly when typology changes in Reference Mode<br>
            <strong>✓ Calculations:</strong> i_39 should update based on the respective mode's typology<br>
            <strong>✓ Section 01:</strong> Reference TEUI (Column E) should use Reference typology, Target TEUI (Column H) should use Design typology
        </div>
    </div>
    
    <div class="test-section">
        <h2>Implementation Details</h2>
        <p><strong>Files Modified:</strong></p>
        <ul>
            <li><code>4011-AppendixE.js</code> - Added d_39 to independently editable fields</li>
            <li><code>sections/4011-Section05.js</code> - Updated dropdown event handler for dual-state support</li>
            <li><code>sections/4011-Section05.js</code> - Added StateManager listener for d_39 changes</li>
        </ul>
        
        <p><strong>Key Features:</strong></p>
        <ul>
            <li>Reference Mode toggle enables/disables d_39 dropdown appropriately</li>
            <li>Dropdown changes update the correct state (Reference vs Application)</li>
            <li><strong>Immediate UI feedback:</strong> i_39 updates visually when typology changes in Reference Mode</li>
            <li>Both calculation engines run to update respective i_39 values</li>
            <li>Section 01 displays correct values in Column E (Reference) and Column H (Target)</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>Test Scenarios</h2>
        <div class="info status">
            <strong>Scenario 1:</strong> Design Mode = "Pt.3 Mass Timber" (350), Reference Mode = "Pt.3 Concrete" (550)<br>
            <strong>Expected:</strong> Column H shows calculations based on 350, Column E shows calculations based on 550<br><br>
            
            <strong>Scenario 2:</strong> Design Mode = "Modelled Value", Reference Mode = "Pt.3 Steel" (650)<br>
            <strong>Expected:</strong> Column H uses i_41 value, Column E shows calculations based on 650<br><br>
            
            <strong>Scenario 3:</strong> Toggle between modes multiple times<br>
            <strong>Expected:</strong> Each mode retains its own typology selection
        </div>
    </div>
    
    <div class="test-section">
        <h2>Quick Links</h2>
        <button onclick="window.open('index.html', '_blank')">Open TEUI Application</button>
        <button onclick="window.open('index.html#emissions', '_blank')">Open Section 05 Directly</button>
    </div>
    
    <script>
        // Simple test helper functions
        function logTest(message) {
            console.log(`[d_39 Test] ${message}`);
        }
        
        // Check if we can access the TEUI application
        function checkTEUIAccess() {
            if (window.opener && window.opener.TEUI) {
                logTest("TEUI application accessible from test window");
                return true;
            } else {
                logTest("TEUI application not accessible - open from main app");
                return false;
            }
        }
        
        // Log test start
        logTest("Test page loaded - ready to test d_39 dual-state separation");
    </script>
</body>
</html> 